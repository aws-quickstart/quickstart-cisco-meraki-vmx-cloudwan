=== High Level Deployment Steps

. Confirm your AWS account configuration
. Subscribe to the {partner-product-short-name} AMI
. Configure your Meraki dashboard
. Launch the Base Region Quick Start
.. Verify that the Cloud WAN resources deployed successfully
.. Add VPC summary route to Cloud WAN VPC Attachment
.. (Optional) Add workload VPCs into Cloud WAN
. (Optional) Launch the Additional Region Quick Start
.. Verify that the Cloud WAN VPC Attachment was created
.. Add VPC summary route to Cloud WAN VPC Attachment
. Verify that routes are being updating
.. Cloud WAN routes
.. VPC return routes

=== Confirm your AWS account configuration

. Sign in to your AWS account at https://aws.amazon.com with an IAM user role that has the necessary permissions. For details, see link:#_planning_the_deployment[Planning the deployment] earlier in this guide.
. Make sure that your AWS account is configured correctly, as discussed in the link:#_technical_requirements[Technical requirements] section.

// Optional based on Marketplace listing. Not to be edited
ifdef::marketplace_subscription[]
=== Subscribe to the {partner-product-short-name} AMI

This Quick Start requires a subscription to the AMI for {partner-product-short-name} in AWS Marketplace.

. Sign in to your AWS account.
. Open the page for the {marketplace_listing_url}[{marketplace_subscription} AMI in AWS Marketplace^], and then choose *Continue to Subscribe*.
. Review the terms and conditions for software usage, and then choose *Accept Terms*. +
  A confirmation page loads, and an email confirmation is sent to the account owner. For detailed subscription instructions, see the https://aws.amazon.com/marketplace/help/200799470[AWS Marketplace documentation^].

. When the subscription process is complete, exit out of AWS Marketplace without further action. *Do not* provision the software from AWS Marketplace—the Quick Start deploys the AMI for you.
endif::marketplace_subscription[]
// \Not to be edited

=== Configure your Meraki dashboard

Before deploying the Quick Start, do the following:

. Complete the instructions in the "Meraki Dashboard Configuration" section of the https://documentation.meraki.com/MX/MX_Installation_Guides/vMX_Setup_Guide_for_Amazon_Web_Services_(AWS)[vMX Setup Guide for Amazon Web Services (AWS)^]. During configuration, you generate authentication tokens for the vMX appliances. Copy and save the tokens. You must enter them in the `vMX1Token` and `vMX2Token` parameters in the AWS CloudFormation console during Quick Start deployment.  

+
image::meraki_vmx1.png[image,width=648,height=439]

. For each template deployed, both Base Region and Additional Region, you must set network tag of vMXn to identify vMX nodes as the primary and secondary hub, respectively.  To set network tags in the Meraki dashboard, see https://documentation.meraki.com/General_Administration/Organizations_and_Networks/Organization_Menu/Manage_Tags[Manage Tags^].

+
TIP: This is to be done at the global dashboard level, and not the vMX Network tab.
+
image::meraki_tags.png[image,width=648,height=439]


. Configure your branch sites as Meraki Auto VPN spokes with the vMX instances as the primary and secondary hubs. For more information, see https://documentation.meraki.com/MX/Site-to-site_VPN/Meraki_Auto_VPN_-_Configuration_and_Troubleshooting[Meraki Auto VPN - Configuration and Troubleshooting^].

.. Add a summary route on each VMx that includes a summary CIDR range of all AWS resources in all regions (optionally, can use multiple CIDRs for non contiguous addresses)

.. Can also optionally advertise the local Transit VPC subnet if needed

+
image::meraki_vpn.png[image,width=648,height=439]

=== Launch the Base Region Quick Start
Each deployment takes about {deployment_time} to complete.

. Deploy the Base Region template
.. Sign in to your AWS account, and choose one of the following options to launch the AWS CloudFormation template. For help with choosing an option, see link:#_deployment_options[Deployment options] earlier in this guide.

+
[cols="3,1"]
|===
^|https://fwd.aws/6aN9v?[Deploy {partner-product-short-name} into a VPC on AWS^]
^|https://fwd.aws/BEEnM?[View template^]

^|https://fwd.aws/JnvKq?[Deploy {partner-product-short-name} into an existing VPC on AWS^]
^|https://fwd.aws/Byq3z?[View template^]

|===
+
.. Check the AWS Region that’s displayed in the upper-right corner of the navigation bar, and change it if necessary. This Region is where you build the network infrastructure. The template is launched in the {default_deployment_region} Region by default. For other choices, see link:#_supported_regions[Supported Regions] earlier in this guide.
.. On the *Create stack* page, keep the default setting for the template URL, and then choose *Next*.
.. On the *Specify stack details* page, change the stack name if needed. Review the parameters for the template. Provide values for the parameters that require input. For all other parameters, review the default settings and customize them as necessary. For details on each parameter, see the link:#_parameter_reference[Parameter reference] section of this guide. When you finish reviewing and customizing the parameters, choose *Next*.
+
In the following tables, parameters are listed by category and described separately for the deployment options. When you finish reviewing and customizing the parameters, choose *Next*.
+
NOTE: Unless you are customizing the Quick Start templates for your own deployment projects, keep the default settings for the parameters *Quick Start S3 bucket name*, *Quick Start S3 bucket Region*, and *Quick Start S3 key prefix*. Changing these settings automatically updates code references to point to a new Quick Start location. For more information, see the https://aws-quickstart.github.io/option1.html[AWS Quick Start Contributor’s Guide^].
+
// Parameter tables linked in here
include::../{generateddir}/parameters/index.adoc[]

+
.. On the *Configure stack options* page, you can https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-resource-tags.html[specify tags^] (key-value pairs) for resources in your stack and https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-console-add-tags.html[set advanced options^]. When you finish, choose *Next*.
.. On the *Review* page, review and confirm the template settings. Under *Capabilities*, select the two check boxes to acknowledge that the template creates IAM resources and might require the ability to automatically expand macros.
.. Choose *Create stack* to deploy the stack.
+
ifndef::partner-product-short-name[.. Monitor the status of the stack. When the status is *CREATE_COMPLETE*, the {partner-product-name} deployment is ready.]
ifdef::partner-product-short-name[.. Monitor the status of the stack. When the status is *CREATE_COMPLETE*, the {partner-product-short-name} deployment is ready.]
.. To view the created resources, see the values displayed in the *Outputs* tab for the stack.


. Verify that the Cloud WAN resources deployed successfully
.. Verify that Step Functions State Machines ran successfully for both the CreateStateMachine as well as the CreateNetworkNewRegion State Machine(runs once per template): https://console.aws.amazon.com/states[Step Function Console^]
+
image::SF_verify.png[image,width=648,height=439]
.. Verify that Cloud WAN contains a Global Network, Core Network, and a VPC Attachment: https://console.aws.amazon.com/networkmanager/home#/networks[Network Manager Console^]
+
image::CW_global_network.png[image,width=648,height=439]
+
image::CW_core_network.png[image,width=648,height=439]
+
image::CW_attachment.png[image,width=648,height=439]

. Add VPC summary route to Cloud WAN VPC Attachment
.. In order for the Transit VPC to route traffic to your Cloud WAN backbone, you must have a route/routes for the IP address range of your AWS workloads across the various deployed regions
.. Pick an IP CIDR range that will differentiate your AWS resources from your branch and on-prem resources
.. Point the route to the Core Network's VPC attachment for the transit VPC
.. See https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Route_Tables.html[LINK^] for guidance
+
image::VPC_RT.gif[image,width=648,height=439]
. (Optional) Add workload VPCs from different Cloud WAN segments into your Core Network Policy
.. If you have workloads in separate Cloud WAN segments, you can advertise those routes to your Meraki SDWAN vMXs via the Core Network Policy
.. See https://aws.amazon.com/blogs/networking-and-content-delivery/introducing-aws-cloud-wan-preview/[LINK^] for guidance

=== Launch the Additional Region Quick Start

Each deployment takes about {deployment_time} to complete.

. Deploy the Additional Region template
+
TIP: Ensure that you are in a different region than the Base Region above
+
.. Sign in to your AWS account, and choose one of the following options to launch the AWS CloudFormation template. For help with choosing an option, see link:#_deployment_options[Deployment options] earlier in this guide.
+
[cols="3,1"]
|===
^|https://fwd.aws/6aN9v?[Deploy {partner-product-short-name} into a VPC on AWS^]
^|https://fwd.aws/BEEnM?[View template^]

^|https://fwd.aws/JnvKq?[Deploy {partner-product-short-name} into an existing VPC on AWS^]
^|https://fwd.aws/Byq3z?[View template^]

|===
+
.. Check the AWS Region that’s displayed in the upper-right corner of the navigation bar, and change it if necessary. This Region is where you build the network infrastructure. The template is launched in the {default_deployment_region} Region by default. For other choices, see link:#_supported_regions[Supported Regions] earlier in this guide.
.. On the *Create stack* page, keep the default setting for the template URL, and then choose *Next*.
.. On the *Specify stack details* page, change the stack name if needed. Review the parameters for the template. Provide values for the parameters that require input. For all other parameters, review the default settings and customize them as necessary. For details on each parameter, see the link:#_parameter_reference[Parameter reference] section of this guide. When you finish reviewing and customizing the parameters, choose *Next*.
+
In the following tables, parameters are listed by category and described separately for the deployment options. When you finish reviewing and customizing the parameters, choose *Next*.
+
NOTE: Unless you are customizing the Quick Start templates for your own deployment projects, keep the default settings for the parameters *Quick Start S3 bucket name*, *Quick Start S3 bucket Region*, and *Quick Start S3 key prefix*. Changing these settings automatically updates code references to point to a new Quick Start location. For more information, see the https://aws-quickstart.github.io/option1.html[AWS Quick Start Contributor’s Guide^].
+
// Parameter tables linked in here
include::../{generateddir}/parameters/index.adoc[]

+
.. On the *Configure stack options* page, you can https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-resource-tags.html[specify tags^] (key-value pairs) for resources in your stack and https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-console-add-tags.html[set advanced options^]. When you finish, choose *Next*.
.. On the *Review* page, review and confirm the template settings. Under *Capabilities*, select the two check boxes to acknowledge that the template creates IAM resources and might require the ability to automatically expand macros.
.. Choose *Create stack* to deploy the stack.
+
ifndef::partner-product-short-name[.. Monitor the status of the stack. When the status is *CREATE_COMPLETE*, the {partner-product-name} deployment is ready.]
ifdef::partner-product-short-name[.. Monitor the status of the stack. When the status is *CREATE_COMPLETE*, the {partner-product-short-name} deployment is ready.]
.. To view the created resources, see the values displayed in the *Outputs* tab for the stack.

. Verify that the Cloud WAN resources deployed successfully
+
TIP: The Cloud WAN resources are executed in the **Base Region** above by the Update State Machine and the CreateNetworkNewRegion State Machine 
.. Verify that Step Functions State Machines ran successfully for the CreateNetworkNewRegion State Machine(runs once per template).  The CreateStateMachine is not ran as Cloud WAN is a global service and only needs to be created once with the Base Template: https://console.aws.amazon.com/states[Step Function Console^]
.. A new SDWAN Attachment will have been created and attached to the Additional Region's Transit VPC

+
image::SF_verify.png[image,width=648,height=439]

.. Verify that Cloud WAN contains a Global Network, Core Network, and a VPC Attachment: https://console.aws.amazon.com/networkmanager/home#/networks[Network Manager Console^]

. Add VPC summary route to Cloud WAN VPC Attachment
.. Follow the same guidance listed in the Base Region to create a similar summary route from the new transit VPC to the new Cloud WAN VPC Attachment
